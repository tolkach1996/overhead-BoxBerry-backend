import{_ as I,o as l,c as g,a as e,b as D,H as F,I as V,p as h,J as $,e as R,t as n,u as r,F as x,A as U,K as W,E as j,G as A,d as y,f as G,L as H,v as m,x as p,i as J,z as S}from"./index-437ec579.js";import{L as K}from"./Loader-d7dcdc23.js";const Q={},X={class:"message"},Y={class:"message__title"},Z={class:"message__image"};function ee(t,s){return l(),g("div",X,[e("div",Y,[D(t.$slots,"title",{},void 0,!0)]),e("div",Z,[D(t.$slots,"content",{},void 0,!0)])])}const M=I(Q,[["render",ee],["__scopeId","data-v-7b0858ae"]]),te="/assets/scanner-314ee725.svg",se="/assets/sadSearch-4fccdd86.svg",re=t=>{if(!t)return"номер телефона";const s=t.replace(/\D/g,"");return`+7 ${s.substring(1,4)} ${s.substring(4,7)}-${s.substring(7,9)}-${s.substring(9)}`},oe=t=>t?new Date(t).toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric"}):"дата",w=t=>Number(t).toFixed(2);class P{static async getOrderById(s){return F.get("ms/orders/"+s)}static async updateStatusById(s){return F.patch("ms/orders/"+s)}}const q=V("orderStore",()=>{const t=h(null),s=h(!1),o=h(!1),a=h(null);async function _(u){t.value=null,s.value=!0,o.value=!1;try{const{order:d}=await P.getOrderById(u);t.value=d}catch{o.value=!0}finally{s.value=!1}}async function c(u){s.value=!0,a.value=null;try{await P.updateStatusById(u)}catch(d){console.error(d),a.value=d.message||"Произошла ошибка"}finally{s.value=!1}}function i(){t.value=null,s.value=!1,o.value=!1}return{order:t,loading:s,notFound:o,textError:a,getOrderById:_,updateOrder:c,newScaning:i}}),z=V("notice",()=>{const t=h(!1),s=h(""),o=h(null);function a(i){o.value&&clearTimeout(o.value),i&&(c(),s.value=i,o.value=setTimeout(()=>{_(),clearTimeout(o.value)},3e3))}function _(){t.value=!1}function c(){t.value=!0}return{show:t,textMessage:s,setText:a,close:_,open:c}});const b=t=>(j("data-v-897e7af9"),t=t(),A(),t),ae=b(()=>e("h1",null,"Выдача заказа",-1)),ne={class:"order"},ce={class:"order__column order__column_size_fixed"},de={class:"card"},_e=b(()=>e("span",{class:"card__name"},"Клиент",-1)),le={class:"user"},ie=b(()=>e("div",{class:"user__avatar"},null,-1)),ue={class:"user-info"},ve={class:"user-info__name"},he={class:"user-info__phone"},fe={class:"card"},ge={class:"card-order__header"},be={class:"card-order__row card-order__row_vertical"},me=b(()=>e("div",{class:"card-order__title"},"Заказ №",-1)),pe={class:"card-order__num-status"},ye={class:"card-order__number"},Se={class:"card-order__status"},we={class:"card-order__row"},xe={class:"card-order__sub-title"},Ie={class:"card-order__comment"},$e=b(()=>e("div",{class:"card-order__title"},"Комментарий",-1)),ke={class:"card-order__text"},Oe={class:"card-order__action"},Ne=["disabled"],Be=["disabled"],Te={class:"order__column"},Ee={class:"order-table"},Le=W('<div class="order-table__row order-table__row_header" data-v-897e7af9><div class="order-table__col" data-v-897e7af9>Наименование товара</div><div class="order-table__col order-table__col_align_right" data-v-897e7af9>Стоимость</div><div class="order-table__col order-table__col_align_center" data-v-897e7af9>Количество</div><div class="order-table__col order-table__col_align_right" data-v-897e7af9>Сумма</div></div>',1),Ce={class:"order-table__col"},De={class:"order-table__col order-table__col_align_right"},Fe={class:"order-table__col order-table__col_align_center"},Me={class:"order-table__col order-table__col_align_right"},Pe={class:"order__summary"},Ve=b(()=>e("span",null,"ИТОГО",-1)),qe={__name:"Order",props:{order:Object},setup(t){const s=t,o=q(),{loading:a,textError:_}=$(o),c=z(),i=R(()=>s.order.positions.rows.reduce((f,O)=>f+=u(O),0));function u(f){return((f==null?void 0:f.price)||0)*f.quantity/100}async function d(){await o.updateOrder(s.order.id),_.value?c.setText(`Ошибка! ${_.value}`):(k(),c.setText("Успешно!"))}function k(){o.newScaning()}return(f,O)=>{var N,B,T,E,L;return l(),g(x,null,[ae,e("div",ne,[e("div",ce,[e("div",de,[_e,e("div",le,[ie,e("div",ue,[e("div",ve,n((N=t.order.agent)==null?void 0:N.name),1),e("div",he,n(r(re)((B=t.order.agent)==null?void 0:B.phone)),1)])])]),e("div",fe,[e("div",ge,[e("div",be,[me,e("div",pe,[e("span",ye,n(t.order.name),1),e("div",Se,n((T=t.order.state)==null?void 0:T.name),1)])]),e("div",we,[e("div",xe,"Дата заказа: "+n(r(oe)((E=t.order)==null?void 0:E.created)),1)])]),e("div",Ie,[$e,e("div",ke,n(t.order.description),1)]),e("div",Oe,[e("button",{class:"card__button card__button_filed",onClick:d,disabled:r(a)},n(r(a)?"Загрузка":"Выдать заказ"),9,Ne),e("button",{class:"card__button card__button_outline",onClick:k,disabled:r(a)},n(r(a)?"Загрузка":"Новое сканирование"),9,Be)])])]),e("div",Te,[e("div",Ee,[Le,(l(!0),g(x,null,U((L=t.order.positions)==null?void 0:L.rows,v=>{var C;return l(),g("div",{class:"order-table__row",key:v.id},[e("div",Ce,n((C=v.assortment)==null?void 0:C.name),1),e("div",De,n(r(w)(((v==null?void 0:v.price)||0)/100)),1),e("div",Fe,n(v==null?void 0:v.quantity),1),e("div",Me,n(r(w)(u(v))),1)])}),128))]),e("div",Pe,[Ve,e("span",null,n(r(w)(i.value)),1)])])])],64)}}},ze=I(qe,[["__scopeId","data-v-897e7af9"]]);const Re={key:0,class:"notice"},Ue={__name:"Notice",setup(t){const s=z(),{show:o,textMessage:a}=$(s);return(_,c)=>r(o)?(l(),g("div",Re,n(r(a)),1)):y("",!0)}},We=I(Ue,[["__scopeId","data-v-c363ea21"]]),je=["src"],Ae=e("br",null,null,-1),Ge=["src"],Ke={__name:"IssueOrdersPage",setup(t){const s=q(),{order:o,loading:a,notFound:_}=$(s),c=h("");function i(u){const d=u.key;d&&(d==="Enter"?(s.getOrderById(c.value),c.value=""):c.value+=String(d))}return G(()=>{window.addEventListener("keypress",i)}),H(()=>{window.removeEventListener("keypress",i)}),(u,d)=>(l(),g(x,null,[!r(o)&&!r(_)&&!r(a)?(l(),m(M,{key:0},{title:p(()=>[S("Начните сканирование для просмотра заказа")]),content:p(()=>[e("img",{src:r(te),alt:""},null,8,je)]),_:1})):r(_)?(l(),m(M,{key:1},{title:p(()=>[S("Товар не найден!"),Ae,S("Начните новое сканирование")]),content:p(()=>[e("img",{src:r(se),alt:""},null,8,Ge)]),_:1})):y("",!0),r(o)?(l(),m(ze,{key:2,order:r(o)},null,8,["order"])):y("",!0),!r(o)&&r(a)?(l(),m(K,{key:3})):y("",!0),J(We)],64))}};export{Ke as default};
